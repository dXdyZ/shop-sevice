# Проект "Shop": Генеральный план (Master Plan)

## 1. Концепция (Product Vision)

Создание современной, масштабируемой бэкенд-платформы для e-commerce. Ключевые принципы: разделение ответственности, отказоустойчивость и независимая масштабируемость компонентов.

## 2. Стек технологий (v2.1, Утвержденный)

- **Язык и фреймворк:** Java 17, Spring Boot 3+
- **Сборка:** Maven
- **Инфраструктура API:**
  - **API Gateway:** NGINX
  - **Service Discovery:** HashiCorp Consul
  - **Dynamic Routing:** consul-template
- **Базы данных:** PostgreSQL (отдельная схема или БД для каждого сервиса)
- **Работа с данными:** Spring Data JPA (Hibernate)
- **Миграции БД:** Liquibase
- **Безопасность:** **Spring Authorization Server (OAuth2)**, Spring Security
- **Асинхронное взаимодействие:** Apache Kafka + Spring for Kafka
- **Тестирование:** JUnit 5, Mockito, Testcontainers
- **Контейнеризация:** Docker, Docker Compose

## 3. Архитектура

Система строится на основе микросервисной архитектуры.

- **API Gateway (NGINX):** Единая точка входа. Валидирует токены доступа, полученные от Auth Service.
- **Service Discovery (Consul):** "Телефонная книга" для сервисов.
- **Auth Service (OAuth2):** **Новый сервис.** Выделенный сервер авторизации. Отвечает за аутентификацию пользователей (через User Service) и выдачу токенов (Access & Refresh tokens).
- **User Service:** Управление профилями пользователей. **Больше не занимается аутентификацией и JWT.** Предоставляет данные для Auth Service и другим сервисам.
- **Product Service:** Управление каталогом товаров.
- **Order Service:** Управление заказами.
- **Inventory Service:** Управление остатками на складе.
- **Message Broker (Kafka):** Асинхронное общение между сервисами через события (например, `OrderCreated`).

## 4. План разработки (Roadmap)

### Фаза 0: Настройка инфраструктуры (Sprint 0)

- [ ] Подготовить `docker-compose.yml` для запуска всех инфраструктурных компонентов (Consul, NGINX, Kafka, PostgreSQL, consul-template).
- [ ] Подготовить базовый конфигурационный файл для NGINX (`nginx.conf`).
- [ ] Подготовить шаблон для consul-template (`nginx.conf.ctmpl`), который будет генерировать конфигурацию для NGINX.
- [ ] Создать мульти-модульную структуру Maven-проекта.

### Фаза 1: Фундамент - Безопасность, Пользователи и Продукты

- [ ] **Разработать `user-service`:**
  - [ ] Настроить подключение к БД и Liquibase.
  - [ ] Настроить регистрацию в Consul.
  - [ ] Реализовать эндпоинты для CRUD операций с пользователями (например, создание пользователя, получение информации о профиле).
  - [ ] Настроить логирование сбор метрик и так далее
- [ ] **Разработать `product-service`:**
  - [ ] Настроить подключение к БД и Liquibase.
  - [ ] Настроить регистрацию в Consul.
  - [ ] Реализовать CRUD эндпоинты для продуктов.
- [ ] Настроить маршрутизацию в NGINX для доступа к новым сервисам.

### Фаза 2: Бизнес-логика - Заказы и Склад

- [ ] Разработать `order-service`.
  - [ ] Реализовать эндпоинт для создания заказа.
  - [ ] Настроить отправку события `OrderCreated` в Kafka.
- [ ] Разработать `inventory-service`.
  - [ ] Настроить прослушивание топика Kafka.
  - [ ] Реализовать логику по уменьшению остатков на складе.

### Фаза 3: Завершение MVP

- [ ] Настроить сборку API-документации (OpenAPI/Swagger).
- [ ] Написать интеграционные тесты с Testcontainers.
- [ ] Стабилизация и исправление багов.